---
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';

interface Props {
    project: {
        title: string;
        description: string;
        image: string | null;
        liveDemoUrl: string;
        githubUrl: string;
        techStack: string[];
        slug?: string;
    };
    index?: number;
}

const { project, index = 0 } = Astro.props;
const { title, description, image, liveDemoUrl, githubUrl, techStack, slug } = project;

const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/**/*.{jpeg,jpg,png,gif}');
---

<div class="card bg-base-100 shadow-xl h-full flex flex-col">
  <figure class="relative aspect-[4/3] w-full bg-base-200">
    {image && images[image] ? (
      <Image 
        src={images[image]()} 
        alt={title}
        class="w-full h-full object-contain"
        loading={index <= 2 ? "eager" : "lazy"}
        decoding={index <= 2 ? "sync" : "async"}
        width={800}
        height={600}
      />
    ) : (
      <div class="w-full h-full flex items-center justify-center text-base-content/50">
        No image available
      </div>
    )}
  </figure>
  <div class="card-body flex flex-col justify-between flex-grow p-6">
    <div>
      <h2 class="card-title text-xl mb-3">{title}</h2>
      <p class="mb-4 text-base-content/80">{description}</p>
      <div class="flex flex-wrap gap-2 mb-4">
        {techStack.map((tech) => (
          <span class="badge badge-outline">{tech}</span>
        ))}
      </div>
    </div>
    <div class="card-actions justify-end">
      <a href={liveDemoUrl} class="btn btn-primary btn-sm">Live Demo</a>
      <a href={`/projects/${slug}`} class="btn btn-secondary btn-sm">View Project</a>
      <a href={githubUrl} class="btn btn-accent btn-sm">GitHub</a>
    </div>
  </div>
</div>
